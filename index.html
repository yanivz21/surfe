<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kate Surfing Game</title>
  <style>
    body, html {
      margin: 0;
      overflow: hidden;
    }
    #gameCanvas {
      background-color: #87CEEB;
      display: block;
    }
    #jumpButton {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 50px;
      background-color: red;
      color: white;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #rotateNotice {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      display: none;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<button id="jumpButton">Jump</button>
<div id="rotateNotice">Please rotate your device to landscape mode for the best experience!</div>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const jumpButton = document.getElementById('jumpButton');
  const rotateNotice = document.getElementById('rotateNotice');

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    scaleGame();
  }

  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('load', resizeCanvas);

  function scaleGame() {
    let scale = Math.min(window.innerWidth / 800, window.innerHeight / 600);
    kate.width = 160 * scale; // הגדלת גודל הגולש פי 2
    kate.height = 160 * scale;
    obstacleSpeed = 5 * scale;
  }

  const surferImage = new Image();
  surferImage.src = 'surfer_with_surfboard.png';

  const fishImage = new Image();
  fishImage.src = 'fish_image.png';

  const lobsterImage = new Image();
  lobsterImage.src = 'lobster_image.png';

  const lobsterSound = new Audio('lobster_sound.mp3');

  let kate = {
    x: 50,
    y: canvas.height - 200, // הנמכת הגולש לחלק התחתון של המסך
    width: 160, // גודל הגולש פי 2
    height: 160,
    dy: 0,
    gravity: 0.5,
    jumpStrength: -10,
    isJumping: false
  };

  let obstacles = [];
  let spawnRate = 90;
  let frameCount = 0;
  let gameStarted = false;
  let score = 0;
  let obstacleSpeed = 5;

  jumpButton.addEventListener('mousedown', () => {
    if (!gameStarted) gameStarted = true;
    if (!kate.isJumping) {
      kate.dy = kate.jumpStrength;
      kate.isJumping = true;
    }
  });

  jumpButton.addEventListener('mouseup', () => {
    kate.isJumping = false;
  });

  function spawnObstacle() {
    let isLobster = Math.random() < 0.1;
    let randomY = Math.random() * (canvas.height - 60);
    obstacles.push({
      x: canvas.width,
      y: randomY,
      width: 40,
      height: 40,
      dx: obstacleSpeed,
      isLobster: isLobster
    });
  }

  function updateKate() {
    if (!gameStarted) return;

    kate.dy += kate.gravity;
    kate.y += kate.dy;

    if (kate.y + kate.height > canvas.height) {
      kate.y = canvas.height - kate.height;
      kate.dy = 0;
      kate.isJumping = false;
    }
  }

  function updateObstacles() {
    if (!gameStarted) return;

    obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
    obstacles.forEach(obstacle => {
      obstacle.x -= obstacle.dx;
    });
  }

  function checkCollision() {
    obstacles.forEach(obstacle => {
      const padding = 20;
      const isCollision =
        kate.x + padding < obstacle.x + obstacle.width &&
        kate.x + kate.width - padding > obstacle.x &&
        kate.y + 30 < obstacle.y + obstacle.height &&
        kate.y + kate.height - padding > obstacle.y;

      if (isCollision) {
        if (obstacle.isLobster) {
          score++;
          lobsterSound.play();
          obstacles = obstacles.filter(o => o !== obstacle);
        } else {
          alert("Game Over! Refresh to try again.");
          resetGame();
        }
      }
    });
  }

  function resetGame() {
    obstacles = [];
    kate.y = canvas.height - kate.height; // החזרת הגולש לתחתית
    kate.dy = 0;
    frameCount = 0;
    score = 0;
    gameStarted = false;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "black";
    ctx.font = "24px Arial";
    ctx.fillText("Score: " + score, canvas.width / 2 - 50, 40);

    if (surferImage.complete) {
      ctx.drawImage(surferImage, kate.x, kate.y, kate.width, kate.height);
    } else {
      ctx.fillStyle = "orange";
      ctx.fillRect(kate.x, kate.y, kate.width, kate.height);
    }

    obstacles.forEach(obstacle => {
      let img = obstacle.isLobster ? lobsterImage : fishImage;
      ctx.drawImage(img, obstacle.x, obstacle.y, obstacle.width, obstacle.height);
    });
  }

  function gameLoop() {
    frameCount++;
    if (frameCount % spawnRate === 0 && gameStarted) spawnObstacle();

    updateKate();
    updateObstacles();
    checkCollision();
    draw();

    requestAnimationFrame(gameLoop);
  }

  function checkOrientation() {
    if (window.innerWidth < window.innerHeight) {
      rotateNotice.style.display = "flex";
    } else {
      rotateNotice.style.display = "none";
    }
  }

  window.addEventListener("resize", checkOrientation);
  window.addEventListener("load", checkOrientation);
  checkOrientation();
  gameLoop();
</script>

</body>
</html>
